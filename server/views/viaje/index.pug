extends ../layout/index
block contenido
    main.container.mt-5
        //- Breadcrumbs
        nav(aria-label="Breadcrumb")
            ol.breadcrumb
                li.breadcrumb-item
                    a(href="/") Inicio
                li.breadcrumb-item
                    a(href="/viajes") Viajes
                li.breadcrumb-item.active(aria-current="page")= viaje.titulo

        //- Imagen principal con atribuci√≥n
        .row.mb-4
            .col-12
                .imagen-viaje-detalle
                    img.img-fluid(
                        src=viaje.imagen,
                        alt=viaje.imagenData ? viaje.imagenData.altDescription : viaje.titulo,
                        style=viaje.imagenData && viaje.imagenData.color ? `background-color: ${viaje.imagenData.color}` : '',
                        onerror="if(this.src!='/img/destinos_grecia.jpg'){this.src='/img/destinos_grecia.jpg'}"
                    )

                    //- Badges de estado
                    .trip-badges
                        //- Badge de urgencia (√∫ltimos lugares)
                        if viaje.disponibles <= 5 && viaje.disponibles > 0
                            span.trip-badge.badge-warning-custom
                                i.fas.fa-exclamation-triangle
                                span ¬°#{viaje.disponibles} #{viaje.disponibles === 1 ? 'lugar' : 'lugares'}!

                        //- Badge Nuevo
                        if viaje.badges && viaje.badges.nuevo
                            span.trip-badge.badge-nuevo
                                i.fas.fa-star
                                span Nuevo

                        //- Badge Descuento
                        if viaje.badges && viaje.badges.descuento
                            span.trip-badge.badge-descuento
                                i.fas.fa-tag
                                span -#{viaje.badges.descuentoPorcentaje}%

                        //- Badge Destacado
                        if viaje.badges && viaje.badges.destacado
                            span.trip-badge.badge-destacado
                                i.fas.fa-fire
                                span Destacado

                    //- Atribuci√≥n del fot√≥grafo
                    if viaje.imagenData && viaje.imagenData.photographer !== 'Esc√°pate Conmigo'
                        .image-credit-detalle
                            small
                                | Foto por
                                a(href=viaje.imagenData.photographerUrl, target="_blank", rel="noopener noreferrer")
                                    = viaje.imagenData.photographer
                                |  en
                                a(href="https://unsplash.com", target="_blank", rel="noopener noreferrer") Unsplash

        //- Contenido principal
        .row
            //- Columna izquierda: Informaci√≥n del viaje
            .col-lg-8.mb-4
                //- T√≠tulo y descripci√≥n
                h1.viaje-titulo #{viaje.titulo}
                p.viaje-descripcion.lead= viaje.descripcion

                //- Informaci√≥n r√°pida en cards
                .info-rapida.mt-4
                    .row
                        .col-6.col-md-3.mb-3
                            .info-card.text-center
                                .info-icon
                                    i.fas.fa-calendar-alt.fa-2x
                                small.d-block.text-muted.mt-2 Salida
                                strong.d-block.mt-1= viaje.fecha_ida

                        .col-6.col-md-3.mb-3
                            .info-card.text-center
                                .info-icon
                                    i.fas.fa-calendar-check.fa-2x
                                small.d-block.text-muted.mt-2 Regreso
                                strong.d-block.mt-1= viaje.fecha_vuelta

                        .col-6.col-md-3.mb-3
                            .info-card.text-center
                                .info-icon
                                    i.fas.fa-users.fa-2x
                                small.d-block.text-muted.mt-2 Disponibles
                                strong.d-block.mt-1(class=viaje.disponibles <= 5 ? 'text-danger' : '')
                                    = viaje.disponibles
                                    |  #{viaje.disponibles === 1 ? 'lugar' : 'lugares'}

                        .col-6.col-md-3.mb-3
                            .info-card.text-center
                                .info-icon
                                    i.fas.fa-tag.fa-2x
                                small.d-block.text-muted.mt-2 Precio
                                strong.d-block.mt-1.precio-destacado= viaje.precio

                //- Botones de compartir en redes sociales
                .share-section.mt-4
                    h5.share-title
                        i.fas.fa-share-alt.mr-2
                        | Compartir este viaje
                    .share-buttons
                        a.share-btn.share-facebook(
                            href=`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(urlCompleta)}`,
                            target="_blank",
                            rel="noopener noreferrer",
                            aria-label="Compartir en Facebook"
                        )
                            i.fab.fa-facebook-f
                            span Facebook

                        a.share-btn.share-twitter(
                            href=`https://twitter.com/intent/tweet?url=${encodeURIComponent(urlCompleta)}&text=${encodeURIComponent('¬°Mira este incre√≠ble viaje a ' + viaje.titulo + '!')}`,
                            target="_blank",
                            rel="noopener noreferrer",
                            aria-label="Compartir en Twitter"
                        )
                            i.fab.fa-twitter
                            span Twitter

                        a.share-btn.share-whatsapp(
                            href=`https://api.whatsapp.com/send?text=${encodeURIComponent('¬°Mira este viaje! ' + viaje.titulo + ' - ' + urlCompleta)}`,
                            target="_blank",
                            rel="noopener noreferrer",
                            aria-label="Compartir en WhatsApp"
                        )
                            i.fab.fa-whatsapp
                            span WhatsApp

                        a.share-btn.share-email(
                            href=`mailto:?subject=${encodeURIComponent('Viaje a ' + viaje.titulo)}&body=${encodeURIComponent('Mira este incre√≠ble viaje: ' + urlCompleta)}`,
                            aria-label="Compartir por Email"
                        )
                            i.fas.fa-envelope
                            span Email

                        button.share-btn.share-copy(
                            type="button",
                            onclick=`navigator.clipboard.writeText('${urlCompleta}').then(() => { this.innerHTML = '<i class=\"fas fa-check\"></i><span>¬°Copiado!</span>'; setTimeout(() => { this.innerHTML = '<i class=\"fas fa-link\"></i><span>Copiar enlace</span>'; }, 2000); })`,
                            aria-label="Copiar enlace"
                        )
                            i.fas.fa-link
                            span Copiar enlace

            //- Columna derecha: CTA Box y Galer√≠a
            .col-lg-4
                //- CTA Box (Call to Action)
                .cta-box
                    .price-box.text-center
                        h3 #{viaje.precio}
                        small por persona

                    if viaje.disponibles > 0
                        if viaje.disponibles <= 5
                            .urgency-badge
                                i.fas.fa-exclamation-triangle
                                | ¬°Solo #{viaje.disponibles === 1 ? 'queda 1 lugar' : `quedan ${viaje.disponibles} lugares`}!

                        //- Bot√≥n de WhatsApp para Reservar
                        a.btn.btn-lg.btn-primary.btn-block(
                            href=`https://wa.me/528116961590?text=${encodeURIComponent(`¬°Hola! Quiero reservar el viaje a *${viaje.titulo}*\n\nüìÖ Salida: ${viaje.fecha_ida}\nüìÖ Regreso: ${viaje.fecha_vuelta}\nüí∞ Precio: ${viaje.precio}\n\n¬øCu√°l es el siguiente paso?`)}`,
                            target="_blank",
                            rel="noopener noreferrer",
                            aria-label="Reservar viaje por WhatsApp"
                        )
                            i.fab.fa-whatsapp
                            |  Reservar Ahora

                        //- Bot√≥n de Email para Consultar
                        a.btn.btn-lg.btn-outline-secondary.btn-block(
                            href=`mailto:info@agenciaviajes.com?subject=${encodeURIComponent(`Consulta: ${viaje.titulo}`)}&body=${encodeURIComponent(`Hola,\n\nMe gustar√≠a consultar la disponibilidad para el viaje:\n\nDestino: ${viaje.titulo}\nSalida: ${viaje.fecha_ida}\nRegreso: ${viaje.fecha_vuelta}\nPrecio: ${viaje.precio}\n\nPor favor, env√≠enme m√°s informaci√≥n sobre:\n- Disponibilidad de lugares\n- Itinerario detallado\n- Forma de pago\n- Requisitos necesarios\n\nGracias,`)}`,
                            aria-label="Consultar disponibilidad por email"
                        )
                            i.fas.fa-envelope
                            |  Consultar Disponibilidad
                    else
                        .alert.alert-danger
                            strong Agotado
                            p Este viaje no tiene lugares disponibles

                //- Galer√≠a adicional (en sidebar)
                if viaje.galeria && viaje.galeria.length > 0
                    .galeria-sidebar.mt-4
                        h4.galeria-titulo
                            i.fas.fa-images.mr-2
                            | M√°s im√°genes
                        .galeria-grid
                            each imagen, index in viaje.galeria.slice(0, 6)
                                .galeria-item(
                                    data-lightbox-index=index,
                                    data-lightbox-url=imagen.url,
                                    data-lightbox-photographer=imagen.photographer,
                                    data-lightbox-photographer-url=imagen.photographerUrl,
                                    data-lightbox-alt=imagen.altDescription,
                                    role="button",
                                    tabindex="0",
                                    aria-label=`Ver imagen ${index + 1} en tama√±o completo`
                                )
                                    img(
                                        src=imagen.urlSmall,
                                        alt=`Vista ${index + 1} de ${viaje.titulo}`,
                                        loading="lazy"
                                    )
                                    .galeria-overlay
                                        i.fas.fa-search-plus

                                    //- Indicador "+X m√°s" en la √∫ltima imagen si hay m√°s fotos
                                    if index === 5 && viaje.galeria.length > 6
                                        .galeria-more-indicator
                                            .more-text
                                                i.fas.fa-images.mb-2
                                                strong +#{viaje.galeria.length - 6}
                                                small Ver todas

        //- Secci√≥n "Qu√© Incluye / No Incluye"
        .row.mt-5
            .col-12
                h2.seccion-titulo.text-center.mb-4
                    i.fas.fa-info-circle.mr-2
                    | Detalles del paquete

            .col-md-6.mb-4.mb-md-0
                .card.incluye-card.h-100
                    .card-body
                        h3.card-title
                            i.fas.fa-check-circle.mr-2
                            | Qu√© incluye
                        ul.list-unstyled.mt-3
                            each item in incluye
                                li.incluye-item
                                    .item-icon
                                        i.fas(class=item.icono)
                                    .item-text= item.texto

            .col-md-6
                .card.no-incluye-card.h-100
                    .card-body
                        h3.card-title
                            i.fas.fa-times-circle.mr-2
                            | No incluye
                        ul.list-unstyled.mt-3
                            each item in noIncluye
                                li.no-incluye-item
                                    .item-icon
                                        i.fas(class=item.icono)
                                    .item-text= item.texto

    //- Modal Lightbox (solo si hay galer√≠a)
    if viaje.galeria && viaje.galeria.length > 0
        #lightboxModal.lightbox-modal(role="dialog", aria-modal="true", aria-label="Galer√≠a de im√°genes")
            .lightbox-overlay
            .lightbox-container
                //- Bot√≥n cerrar
                button.lightbox-close(type="button", aria-label="Cerrar galer√≠a")
                    i.fas.fa-times

                //- Navegaci√≥n
                button.lightbox-nav.lightbox-prev(type="button", aria-label="Imagen anterior")
                    i.fas.fa-chevron-left
                button.lightbox-nav.lightbox-next(type="button", aria-label="Imagen siguiente")
                    i.fas.fa-chevron-right

                //- Contenedor de imagen
                .lightbox-image-wrapper
                    img#lightboxImage.lightbox-image(src="", alt="")
                    .lightbox-loader
                        .spinner

                //- Informaci√≥n de la imagen
                .lightbox-info
                    .lightbox-counter
                        span#lightboxCurrent 1
                        |  /#{' '}
                        span#lightboxTotal= viaje.galeria.length
                    .lightbox-photographer
                        i.fas.fa-camera.mr-2
                        | Foto por:#{' '}
                        a#lightboxPhotographerLink(href="#", target="_blank", rel="noopener noreferrer")
                            span#lightboxPhotographer
                        |  en#{' '}
                        a(href="https://unsplash.com", target="_blank", rel="noopener noreferrer") Unsplash

                //- Thumbnails
                .lightbox-thumbnails#lightboxThumbnails
                    each imagen, index in viaje.galeria
                        img.lightbox-thumb(
                            src=imagen.urlSmall,
                            alt=`Miniatura ${index + 1}`,
                            data-thumb-index=index,
                            class=index === 0 ? 'active' : ''
                        )

block scripts
    if viaje.galeria && viaje.galeria.length > 0
        script(src="/js/lightbox.js", defer)
