extends ../layout/index
block contenido
    main.container.mt-5
        //- Breadcrumbs
        nav(aria-label="Breadcrumb")
            ol.breadcrumb
                li.breadcrumb-item
                    a(href="/") Inicio
                li.breadcrumb-item
                    a(href="/viajes") Viajes
                li.breadcrumb-item.active(aria-current="page")= viaje.titulo

        //- Imagen principal con atribución
        .row.mb-4
            .col-12(data-aos="zoom-in", data-aos-duration="1000")
                .imagen-viaje-detalle
                    img.img-fluid(
                        src=viaje.imagen,
                        alt=viaje.imagenData ? viaje.imagenData.altDescription : viaje.titulo,
                        style=viaje.imagenData && viaje.imagenData.color ? `background-color: ${viaje.imagenData.color}` : '',
                        onerror="if(this.src!='/img/destinos_grecia.jpg'){this.src='/img/destinos_grecia.jpg'}"
                    )

                    //- Badges de estado
                    .trip-badges
                        //- Badge de urgencia (últimos lugares)
                        if viaje.disponibles <= 5 && viaje.disponibles > 0
                            span.trip-badge.badge-warning-custom
                                i.fas.fa-exclamation-triangle
                                span ¡#{viaje.disponibles} #{viaje.disponibles === 1 ? 'lugar' : 'lugares'}!

                        //- Badge Nuevo
                        if viaje.badges && viaje.badges.nuevo
                            span.trip-badge.badge-nuevo
                                i.fas.fa-star
                                span Nuevo

                        //- Badge Descuento
                        if viaje.badges && viaje.badges.descuento
                            span.trip-badge.badge-descuento
                                i.fas.fa-tag
                                span -#{viaje.badges.descuentoPorcentaje}%

                        //- Badge Destacado
                        if viaje.badges && viaje.badges.destacado
                            span.trip-badge.badge-destacado
                                i.fas.fa-fire
                                span Destacado

                    //- Atribución del fotógrafo
                    if viaje.imagenData && viaje.imagenData.photographer !== 'Escápate Conmigo'
                        .image-credit-detalle
                            small
                                | Foto por
                                a(href=viaje.imagenData.photographerUrl, target="_blank", rel="noopener noreferrer")
                                    = viaje.imagenData.photographer
                                |  en
                                a(href="https://unsplash.com", target="_blank", rel="noopener noreferrer") Unsplash

        //- Contenido principal
        .row
            //- Columna izquierda: Información del viaje
            .col-lg-8.mb-4
                //- Título y descripción
                h1.viaje-titulo(data-aos="fade-right") #{viaje.titulo}
                p.viaje-descripcion.lead(data-aos="fade-right", data-aos-delay="100")= viaje.descripcion

                //- Información rápida en cards
                .info-rapida.mt-4(data-aos="fade-up", data-aos-delay="200")
                    .row
                        .col-6.col-md-3.mb-3
                            .info-card.text-center
                                .info-icon
                                    i.fas.fa-calendar-alt.fa-2x
                                small.d-block.text-muted.mt-2 Salida
                                strong.d-block.mt-1= viaje.fecha_ida

                        .col-6.col-md-3.mb-3
                            .info-card.text-center
                                .info-icon
                                    i.fas.fa-calendar-check.fa-2x
                                small.d-block.text-muted.mt-2 Regreso
                                strong.d-block.mt-1= viaje.fecha_vuelta

                        .col-6.col-md-3.mb-3
                            .info-card.text-center
                                .info-icon
                                    i.fas.fa-users.fa-2x
                                small.d-block.text-muted.mt-2 Disponibles
                                strong.d-block.mt-1(class=viaje.disponibles <= 5 ? 'text-danger' : '')
                                    = viaje.disponibles
                                    |  #{viaje.disponibles === 1 ? 'lugar' : 'lugares'}

                        .col-6.col-md-3.mb-3
                            .info-card.text-center
                                .info-icon
                                    i.fas.fa-tag.fa-2x
                                small.d-block.text-muted.mt-2 Precio
                                strong.d-block.mt-1.precio-destacado= viaje.precio

                //- Botones de compartir en redes sociales
                .share-section.mt-4(data-aos="fade-up", data-aos-delay="300")
                    h5.share-title
                        i.fas.fa-share-alt.mr-2
                        | Compartir este viaje
                    .share-buttons
                        a.share-btn.share-facebook(
                            href=`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(urlCompleta)}`,
                            target="_blank",
                            rel="noopener noreferrer",
                            aria-label="Compartir en Facebook"
                        )
                            i.fab.fa-facebook-f
                            span Facebook

                        a.share-btn.share-twitter(
                            href=`https://twitter.com/intent/tweet?url=${encodeURIComponent(urlCompleta)}&text=${encodeURIComponent('¡Mira este increíble viaje a ' + viaje.titulo + '!')}`,
                            target="_blank",
                            rel="noopener noreferrer",
                            aria-label="Compartir en Twitter"
                        )
                            i.fab.fa-twitter
                            span Twitter

                        a.share-btn.share-whatsapp(
                            href=`https://api.whatsapp.com/send?text=${encodeURIComponent('¡Mira este viaje! ' + viaje.titulo + ' - ' + urlCompleta)}`,
                            target="_blank",
                            rel="noopener noreferrer",
                            aria-label="Compartir en WhatsApp"
                        )
                            i.fab.fa-whatsapp
                            span WhatsApp

                        a.share-btn.share-email(
                            href=`mailto:?subject=${encodeURIComponent('Viaje a ' + viaje.titulo)}&body=${encodeURIComponent('Mira este increíble viaje: ' + urlCompleta)}`,
                            aria-label="Compartir por Email"
                        )
                            i.fas.fa-envelope
                            span Email

                        button.share-btn.share-copy(
                            type="button",
                            onclick=`navigator.clipboard.writeText('${urlCompleta}').then(() => { this.innerHTML = '<i class=\"fas fa-check\"></i><span>¡Copiado!</span>'; setTimeout(() => { this.innerHTML = '<i class=\"fas fa-link\"></i><span>Copiar enlace</span>'; }, 2000); })`,
                            aria-label="Copiar enlace"
                        )
                            i.fas.fa-link
                            span Copiar enlace

            //- Columna derecha: CTA Box y Galería
            .col-lg-4
                //- CTA Box (Call to Action)
                .cta-box(data-aos="fade-left", data-aos-delay="100")
                    .price-box.text-center
                        h3 #{viaje.precio}
                        small por persona

                    if viaje.disponibles > 0
                        if viaje.disponibles <= 5
                            .urgency-badge
                                i.fas.fa-exclamation-triangle
                                | ¡Solo #{viaje.disponibles === 1 ? 'queda 1 lugar' : `quedan ${viaje.disponibles} lugares`}!

                        button.btn.btn-lg.btn-primary.btn-block(type="button")
                            i.fas.fa-calendar-check
                            |  Reservar Ahora

                        button.btn.btn-lg.btn-outline-secondary.btn-block(type="button")
                            i.fas.fa-envelope
                            |  Consultar Disponibilidad
                    else
                        .alert.alert-danger
                            strong Agotado
                            p Este viaje no tiene lugares disponibles

                //- Galería adicional (en sidebar)
                if viaje.galeria && viaje.galeria.length > 0
                    .galeria-sidebar.mt-4(data-aos="fade-left", data-aos-delay="200")
                        h4.galeria-titulo
                            i.fas.fa-images.mr-2
                            | Más imágenes
                        .galeria-grid
                            each imagen, index in viaje.galeria.slice(0, 6)
                                .galeria-item(
                                    data-lightbox-index=index,
                                    data-lightbox-url=imagen.url,
                                    data-lightbox-photographer=imagen.photographer,
                                    data-lightbox-photographer-url=imagen.photographerUrl,
                                    data-lightbox-alt=imagen.altDescription,
                                    role="button",
                                    tabindex="0",
                                    aria-label=`Ver imagen ${index + 1} en tamaño completo`
                                )
                                    img(
                                        src=imagen.urlSmall,
                                        alt=`Vista ${index + 1} de ${viaje.titulo}`,
                                        loading="lazy"
                                    )
                                    .galeria-overlay
                                        i.fas.fa-search-plus

                                    //- Indicador "+X más" en la última imagen si hay más fotos
                                    if index === 5 && viaje.galeria.length > 6
                                        .galeria-more-indicator
                                            .more-text
                                                i.fas.fa-images.mb-2
                                                strong +#{viaje.galeria.length - 6}
                                                small Ver todas

        //- Sección "Qué Incluye / No Incluye"
        .row.mt-5
            .col-12
                h2.seccion-titulo.text-center.mb-4(data-aos="fade-up")
                    i.fas.fa-info-circle.mr-2
                    | Detalles del paquete

            .col-md-6.mb-4.mb-md-0(data-aos="fade-right", data-aos-delay="100")
                .card.incluye-card.h-100
                    .card-body
                        h3.card-title
                            i.fas.fa-check-circle.mr-2
                            | Qué incluye
                        ul.list-unstyled.mt-3
                            each item in incluye
                                li.incluye-item
                                    .item-icon
                                        i.fas(class=item.icono)
                                    .item-text= item.texto

            .col-md-6(data-aos="fade-left", data-aos-delay="200")
                .card.no-incluye-card.h-100
                    .card-body
                        h3.card-title
                            i.fas.fa-times-circle.mr-2
                            | No incluye
                        ul.list-unstyled.mt-3
                            each item in noIncluye
                                li.no-incluye-item
                                    .item-icon
                                        i.fas(class=item.icono)
                                    .item-text= item.texto

    //- Modal Lightbox (solo si hay galería)
    if viaje.galeria && viaje.galeria.length > 0
        #lightboxModal.lightbox-modal(role="dialog", aria-modal="true", aria-label="Galería de imágenes")
            .lightbox-overlay
            .lightbox-container
                //- Botón cerrar
                button.lightbox-close(type="button", aria-label="Cerrar galería")
                    i.fas.fa-times

                //- Navegación
                button.lightbox-nav.lightbox-prev(type="button", aria-label="Imagen anterior")
                    i.fas.fa-chevron-left
                button.lightbox-nav.lightbox-next(type="button", aria-label="Imagen siguiente")
                    i.fas.fa-chevron-right

                //- Contenedor de imagen
                .lightbox-image-wrapper
                    img#lightboxImage.lightbox-image(src="", alt="")
                    .lightbox-loader
                        .spinner

                //- Información de la imagen
                .lightbox-info
                    .lightbox-counter
                        span#lightboxCurrent 1
                        |  /#{' '}
                        span#lightboxTotal= viaje.galeria.length
                    .lightbox-photographer
                        i.fas.fa-camera.mr-2
                        | Foto por:#{' '}
                        a#lightboxPhotographerLink(href="#", target="_blank", rel="noopener noreferrer")
                            span#lightboxPhotographer
                        |  en#{' '}
                        a(href="https://unsplash.com", target="_blank", rel="noopener noreferrer") Unsplash

                //- Thumbnails
                .lightbox-thumbnails#lightboxThumbnails
                    each imagen, index in viaje.galeria
                        img.lightbox-thumb(
                            src=imagen.urlSmall,
                            alt=`Miniatura ${index + 1}`,
                            data-thumb-index=index,
                            class=index === 0 ? 'active' : ''
                        )

block scripts
    if viaje.galeria && viaje.galeria.length > 0
        script(src="/js/lightbox.js", defer)
